// Сортировка пузырьком с использованием нового синтаксиса индексов
функция сортировка_пузырьком(сп) {
    дл = длина(сп);
    для (i = 0; i < дл; i += 1) {
        для (j = 1; j < дл - i; j += 1) {
            // Читаем через [j]
            если (сп[j - 1] > сп[j]) {
                врем = сп[j - 1];
                // Записываем через [j] =
                сп.задать(j - 1, j);
                сп.задать(j, врем);
            }
        }
    }
    вернуть сп;
}

// Быстрая сортировка
функция быстрая_сортировка(сп) {
    если (сп.длина() <= 1) {
        вернуть сп;
    }
    
    опорный = сп[0]; // Индекс вместо получить()
    левый = список();
    правый = список();

    для (i = 1; i < сп.длина(); i += 1) {
        текущее = сп[i];
        если (текущее < опорный) {
            левый.добавить(текущее);
        } иначе {
            правый.добавить(текущее);
        }
    }
    
    левый_сортированный = быстрая_сортировка(левый);
    правый_сортированный = быстрая_сортировка(правый);

    результат = список();

    для (j = 0; j < левый_сортированный.длина(); j += 1) {
        результат.добавить(левый_сортированный[j]);
    }
    результат.добавить(опорный);
    для (k = 0; k < правый_сортированный.длина(); k += 1) {
        результат.добавить(правый_сортированный[k]);
    }
    вернуть результат;
}

// Бинарный поиск
функция бинарный_поиск(сп, значение) {
    мин = 0;
    макс = сп.длина() - 1;
    пока(мин <= макс) {
        середина = мин + (макс - мин) / 2;
        если(сп[середина] == значение) {
            вернуть середина;
        }
        иначе если(сп[середина] < значение) {
            мин = середина + 1;
        }
        иначе {
            макс = середина - 1;
        }
    }
    вернуть -1;
}

// Функции высшего порядка
функция применить_ко_всем(сп, ф) {
    результат = список();
    для (k = 0; k < сп.длина(); k += 1) {
        результат.добавить(ф(сп[k]));
    }
    вернуть результат;
}

функция фильтр(сп, ф) {
    результат = список();
    для (k = 0; k < сп.длина(); k += 1) {
        если(ф(сп[k])) {
            результат.добавить(сп[k]);
        }
    }
    вернуть результат;
}

// --- Тесты ---

сп2 = список(1, 6, 3, 7, 5);
печать("Исходный: ", сп2);

сортированный_сп = быстрая_сортировка(сп2);
печать("Быстрая сортировка: ", сортированный_сп);
печать("Поиск числа 3: индекс ", бинарный_поиск(сортированный_сп, 3));

функция умн_2(ч) { вернуть ч * 2; }
функция больше_4(ч) { вернуть ч > 4; }

сп3 = список(1, 2, 3, 4, 5);
печать("Применить умн_2: ", применить_ко_всем(сп3, умн_2));
печать("Фильтр больше_4: ", фильтр(сп3, больше_4));

// Демонстрация вложенных списков
сп_сп = список(список(1,2,3), список(4,5,6), список(7,8,9));
печать("Второй элемент второго списка: ", сп_сп[1][1]); // Выведет 5
